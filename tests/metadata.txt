
Create the channel.

  >>> from smart.channel import createChannel
  >>> channel = createChannel("alias",
  ...                         {"type": "rpm-md",
  ...                          "baseurl": "file://%s/rpm" % TESTDATADIR})
  >>> channel
  <smart.channels.rpm_md.RPMMetaDataChannel object at ...>


We need a progress and a fetcher.

  >>> from smart.progress import Progress
  >>> from smart.fetcher import Fetcher
  >>> progress = Progress()
  >>> fetcher = Fetcher()


Fetch channel data.

  >>> channel.fetch(fetcher, progress)
  True
  >>> channel.getLoaders()
  [<smart.backends.rpm.metadata.RPMMetaDataLoader object at ...>]


Let's create a cache to put the loader in, so that we can test it.

  >>> from smart.cache import Cache
  >>> loader = channel.getLoaders()[0]
  >>> cache = Cache()
  >>> cache.addLoader(loader)


The setup is ready. Now we can load the data into the cache.

  >>> cache.load()
  Updating cache...               ######################################## [100%]
  <BLANKLINE>


This should give us one package with the data we already know.

  >>> cache.getPackages()
  [name-version-release@noarch]

  >>> pkg = cache.getPackages()[0]
  >>> type(pkg)
  <class 'smart.backends.rpm.base.RPMPackage'>


Let's inspect the package data.

  >>> pkg.name
  'name'
  >>> pkg.version
  'version-release@noarch'

  >>> sorted(pkg.provides)
  [name = version-release@noarch, providename = provideversion]
  >>> [type(x).__name__ for x in sorted(pkg.provides)]
  ['RPMNameProvides', 'RPMProvides']

  >>> sorted(pkg.requires)
  [/bin/sh, prerequirename = prerequireversion, requirename = requireversion]
  >>> # XXX pre-requires are broken in createrepo
  >>> [type(x).__name__ for x in sorted(pkg.requires)]
  ['RPMRequires', 'RPMRequires', 'RPMRequires']

  >>> sorted(pkg.upgrades)
  [name < version-release@noarch, obsoletesname = obsoletesversion]
  >>> [type(x).__name__ for x in sorted(pkg.upgrades)]
  ['RPMObsoletes', 'RPMObsoletes']

  >>> sorted(pkg.conflicts)
  [conflictsname = conflictsversion, obsoletesname = obsoletesversion]
  >>> [type(x).__name__ for x in sorted(pkg.conflicts)]
  ['RPMConflicts', 'RPMObsoletes']


Now let's ask the loader for a PackageInfo instance, and inspect it.

  >>> info = loader.getInfo(pkg)
  >>> info
  <smart.backends.rpm.metadata.RPMMetaDataPackageInfo object at ...>

  >>> info.getGroup()
  'Group'
  >>> info.getSummary()
  'Summary'
  >>> info.getDescription()
  'Description'

  >>> info.getURLs()
  ['file:///.../tests/data/rpm/name-version-release.noarch.rpm']
  >>> url = info.getURLs()[0]

  >>> info.getSHA(url)
  'b096e68f4b346261f521f025f446cf59a0e875fd'
  >>> info.getSize(url)
  2129


vim:ft=doctest
